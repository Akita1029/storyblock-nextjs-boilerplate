var l = Object.defineProperty;
var u = (e, t, r) => t in e ? l(e, t, { enumerable: !0, configurable: !0, writable: !0, value: r }) : e[t] = r;
var a = (e, t, r) => (u(e, typeof t != "symbol" ? t + "" : t, r), r);
const g = function(e, t) {
  const r = {};
  for (const n in e) {
    const s = e[n];
    t.indexOf(n) > -1 && s !== null && (r[n] = s);
  }
  return r;
}, h = (e) => e === "email", d = () => ({
  singleTag: "hr"
}), f = () => ({
  tag: "blockquote"
}), p = () => ({
  tag: "ul"
}), k = (e) => ({
  tag: [
    "pre",
    {
      tag: "code",
      attrs: e.attrs
    }
  ]
}), m = () => ({
  singleTag: "br"
}), T = (e) => ({
  tag: `h${e.attrs.level}`
}), $ = (e) => ({
  singleTag: [
    {
      tag: "img",
      attrs: g(e.attrs, ["src", "alt", "title"])
    }
  ]
}), y = () => ({
  tag: "li"
}), M = () => ({
  tag: "ol"
}), b = () => ({
  tag: "p"
}), v = () => ({
  tag: "b"
}), E = () => ({
  tag: "strike"
}), x = () => ({
  tag: "u"
}), N = () => ({
  tag: "strong"
}), _ = () => ({
  tag: "code"
}), H = () => ({
  tag: "i"
}), S = (e) => {
  const t = { ...e.attrs }, { linktype: r = "url" } = e.attrs;
  return h(r) && (t.href = `mailto:${t.href}`), t.anchor && (t.href = `${t.href}#${t.anchor}`, delete t.anchor), {
    tag: [
      {
        tag: "a",
        attrs: t
      }
    ]
  };
}, j = (e) => ({
  tag: [
    {
      tag: "span",
      attrs: e.attrs
    }
  ]
}), O = {
  nodes: {
    horizontal_rule: d,
    blockquote: f,
    bullet_list: p,
    code_block: k,
    hard_break: m,
    heading: T,
    image: $,
    list_item: y,
    ordered_list: M,
    paragraph: b
  },
  marks: {
    bold: v,
    strike: E,
    underline: x,
    strong: N,
    code: _,
    italic: H,
    link: S,
    styled: j
  }
}, q = function(e) {
  const t = {
    "&": "&amp;",
    "<": "&lt;",
    ">": "&gt;",
    '"': "&quot;",
    "'": "&#39;"
  }, r = /[&<>"']/g, n = RegExp(r.source);
  return e && n.test(e) ? e.replace(r, (s) => t[s]) : e;
};
class C {
  constructor(t) {
    a(this, "marks");
    a(this, "nodes");
    t || (t = O), this.marks = t.marks || [], this.nodes = t.nodes || [];
  }
  addNode(t, r) {
    this.nodes[t] = r;
  }
  addMark(t, r) {
    this.marks[t] = r;
  }
  render(t) {
    if (t && t.content && Array.isArray(t.content)) {
      let r = "";
      return t.content.forEach((n) => {
        r += this.renderNode(n);
      }), r;
    }
    return console.warn(
      "The render method must receive an object with a content field, which is an array"
    ), "";
  }
  renderNode(t) {
    const r = [];
    t.marks && t.marks.forEach((s) => {
      const o = this.getMatchingMark(s);
      o && r.push(this.renderOpeningTag(o.tag));
    });
    const n = this.getMatchingNode(t);
    return n && n.tag && r.push(this.renderOpeningTag(n.tag)), t.content ? t.content.forEach((s) => {
      r.push(this.renderNode(s));
    }) : t.text ? r.push(q(t.text)) : n && n.singleTag ? r.push(this.renderTag(n.singleTag, " /")) : n && n.html && r.push(n.html), n && n.tag && r.push(this.renderClosingTag(n.tag)), t.marks && t.marks.slice(0).reverse().forEach((s) => {
      const o = this.getMatchingMark(s);
      o && r.push(this.renderClosingTag(o.tag));
    }), r.join("");
  }
  renderTag(t, r) {
    return t.constructor === String ? `<${t}${r}>` : t.map((s) => {
      if (s.constructor === String)
        return `<${s}${r}>`;
      {
        let o = `<${s.tag}`;
        if (s.attrs)
          for (const c in s.attrs) {
            const i = s.attrs[c];
            i !== null && (o += ` ${c}="${i}"`);
          }
        return `${o}${r}>`;
      }
    }).join("");
  }
  renderOpeningTag(t) {
    return this.renderTag(t, "");
  }
  renderClosingTag(t) {
    return t.constructor === String ? `</${t}>` : t.slice(0).reverse().map((n) => n.constructor === String ? `</${n}>` : `</${n.tag}>`).join("");
  }
  getMatchingNode(t) {
    const r = this.nodes[t.type];
    if (typeof r == "function")
      return r(t);
  }
  getMatchingMark(t) {
    const r = this.marks[t.type];
    if (typeof r == "function")
      return r(t);
  }
}
export {
  C as default
};
